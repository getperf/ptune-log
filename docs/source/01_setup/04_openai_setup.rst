タグ生成用生成AIサービスのキー取得と設定方法
==================================================

このセクションでは、`ptune-log` プラグインでタグの自動生成に必要な
生成AIサービス（OpenAI, Google Gemini, Anthropic Claude など）の
APIキー取得と設定方法について説明します。

背景と概要
-----------

- タグの自動生成には外部の生成AIサービスを利用します。
- 現在サポートしているプロバイダーは以下の通りです:
  
  * OpenAI Chat (GPT)
  * Google Gemini
  * Anthropic Claude
  * その他カスタムエンドポイント

- いずれも **有償ライセンス** の利用が前提であり、
  APIキーを取得し、Obsidian プラグイン設定画面に登録する必要があります。

.. note::

   以下の何れかの生成AIサービスの API キーが必要になります。

1. OpenAI APIキーの取得
-----------------------------

- キー発行: https://platform.openai.com/account/api-keys

1. OpenAIにログインし「+ Create new secret key」をクリック
2. 表示されたキーをコピーし、安全に保管してください
3. API利用にはクレジットカード等の支払い方法を登録する必要があります

.. image:: ../../images/openai_create_key.png
   :alt: OpenAI APIキーの作成画面
   :width: 600px
   :align: center

2. Google Gemini APIキーの取得
------------------------------------

- キー発行: https://aistudio.google.com/app/apikey

1. Googleアカウントでログイン
2. 「Create API key」から新しいキーを生成
3. API利用には Google Cloud Billing の有効化が必要です

3. Anthropic Claude APIキーの取得
-----------------------------------------

- キー発行: https://console.anthropic.com/account/keys

1. Anthropic アカウントを作成
2. 「Create Key」で新しいキーを生成
3. 課金設定が未登録の場合、キーは利用できません

4. Obsidian プラグインでの設定
-------------------------------

1. Obsidian の設定画面を開く
2. サイドバーから `ptune-log` プラグイン設定を選択
3. 以下の項目を入力します:

   - **プロバイダー**: OpenAI / Gemini / Claude / Custom のいずれかを選択
   - **API Key**: 各サービスで発行したAPIキーを入力（必須）
   - **Base URL**: デフォルト値が自動入力されます（必要に応じて変更）
   - **モデル**: 利用可能なモデル名を選択
   - **温度 (temperature)**: 出力の多様性を指定（0.0〜1.0）
   - **最大トークン数**: 出力の上限トークン数を指定

.. note::

   プロバイダーとAPIキーの設定が完了すればタグ生成機能を利用可能です。
   その他の設定（Base URL、モデル、温度、最大トークン数）は任意で調整します。

5. 動作確認
------------

設定後、ノートの「タグ自動生成」機能を実行して動作を確認します。
ファイルエクスプローラ画面から、任意のノートを選択し、 **右クリック** > **LLMでタグを自動生成** を選択します。
実行後、ノートの先頭(YAMLヘッダー)にタグ候補が生成されるか確認してください。

6. プロンプトのカスタマイズ
-----------------------------------

タグ生成結果の品質を高めるため、ノートの性質に応じて
最適なプロンプトテンプレートを選択・編集できます。

**背景と目的**

タグ生成はノートの内容（開発ノート、日記、研究メモなど）により適したプロンプトが異なります。  
`ptune-log` では、以下４種類のテンプレートを標準で用意しています。

- 標準（General）
- 開発ノート（Development）
- 日記ログ（Journal）
- 研究メモ（Research）

**手順**

1. Obsidian の設定画面を開き、サイドバーから `ptune-log` を選択します。
2. 「LLM タグ生成設定」セクションの **「テンプレートを選択」** ボタンをクリックします。
3. 表示されたダイアログから、用途に合ったテンプレートを選択します。
4. テンプレート内容を編集したい場合は、右側の **「テンプレートを開く」** ボタンをクリックします。
   `_templates/llm/tag_generate.md` が開き、優先して使用するタグリストやプロンプト文をカスタマイズできます。
5. 編集後は上書き保存してください。次回以降のタグ生成処理で反映されます。

.. note::

   カスタマイズ内容には「タグ生成で優先的に使用するタグリスト」や
   「生成AIに与える説明文」を含めることができます。
   自身のノート構成やドメイン（開発・研究・ライフログなど）に合わせて最適化してください。

7. トラブルシューティング
--------------------------

- **応答がない / タイムアウト**  
  → APIキーが無効、またはネットワークが遮断されている可能性があります。

- **Quota exceeded / 課金関連のエラー**  
  → 無料枠を超過、または支払い方法が未登録です。各サービスの課金状況を確認してください。

- **VPN/Proxy利用時に失敗する**  
  → 通信制限の影響で失敗する場合があります。一時的に無効化してお試しください。

8. 各サービスの課金状況リンク
-------------------------------

- OpenAI: https://platform.openai.com/account/usage
- Gemini: https://aistudio.google.com/app/billing
- Claude: https://console.anthropic.com/account/billing
